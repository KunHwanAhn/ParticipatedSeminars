# Amazon AWS EC2

## EC2 개요

### 개념
- Amazon Elastic Compute Cloud (EC2)란?
  - AWS 글로벌 리전 내의 물리 서버위의 Host Server위에서 동작하는 **가상 서버**

### 유형 및 특징
- 범용(M) - 컴퓨팅, 메모리, 네트워크 리소스를 균형있게 / 중소형 DB, 엔터프라이즈 애플리케이션
- 마이크로(T) - 개발환경, 마이크로 서비스
- 컴퓨팅 최적화(C) - 고성능 프론트엔드, 웹 서버, 배치 처리, 게임
- 저장소 최적화(I, D)
  - I: NoSQL DB, DW, 하둡 및 분산 파일 시스템
  - D: MPP DW, 맵리듀스
- 메모리 최적화(X, R)
  - X: SAP HANA, Apache Spark 및 Presto
  - R: 고성능 DB, 분산 메모리 캐시, 게놈 분석
- GPU 최적화(G, P, F): 3D 앱 스트리밍, ML

### 표기법
- c4.large
  - c: 인스턴스 패밀리
  - 4: 인스턴스 세대
  - large: 인스턴스 크기, nano, micro, medium, large, xlarge, 2xlarge, 4xlarge, 8xlarge, 10xlarge, 16xlarge, 32xlarge

### 성능요소

#### CPU
- Intel Xeon CPU

#### Network
- Enhanced Networking Types
  - VF: 10Gbps / C3, C4, D2, I2, R3, M4
  - ENA: 25Gbps / F1, G3, I3, P2, R4, X1, M4.16xlarge
  - 타입이 없는 경우는, 최대한으로 속도를 제공하지만 보장하지는 않는다.

#### 메모리
- X1 Instance: 엔터프라이즈급 인 메모리 애플리케이션에 최적화

#### 스토리지
- Instance Store (DAS)
  - N/A HDD, SSD, NVMe(SSD)
  - 초기화 후, mount 수행
  - Data Persistent 용으로 사용하지 않음
- 네트워크 연결 (NAS)
  - Amazon EBS 범용(SSD) 볼륨
  - Amazon EBS 프로비저닝된 IOPS (SSD) 볼륨
  - Amzaon EBS 하드 디스크 드라이브(다양한 사례를 위한 여러 유형)
  - Amazon EFS (확장성 있는 공유 NFSv4 파일 시스템을 수초 내에 생성)
  - Amazon S3와 Amazon Glacier (오브젝트 스토리지)

### 인스턴스의 크기
- c4.8xlarge = c4.4xlarge * 2 = c4.2xlarge * 4 = c4.xlarge * 8
  - c4.8xlarge의 CPU가 16개라면?
    - c4.4xlarge: 8개
    - c4.2xlarge: 4개
    - c4.xlarge: 2개

### T Type 크레딧 작동원리
- t2.nano
 - 기본 성능: 5%
 - CPU 크레딧 / 시간당 3
 - 1시간 동안 크레딧을 쌓아놨다면, 3분 동안 100%로 사용할 수 있으나, 소진 이후부터는, 15분 동단 점점 줄어서 CPU 사용량을 줄인다.

## EC2 시작하기

### EC2 생성 및 이용 절차

#### EC2 가상머신 생성, 삭제 및 관리

#### AWS에서 EC2 가상머신 생성
- EC2 가상머신 생성 시, Private Key를 단 한 번 받을 수 있는 기회를 제공함.

#### SSH 공개키 인증을 통한 원격 접속
- 전달 받은 Private Key를 이용하여 SSH 접속

### 생명 주기

#### Amazon Machine Image(AMI)를 이용하여 EC2 Launch

#### 실행중(Running)
- 인스턴스가 동작 중인상태
- 과금 발생
- 정지 / 종료 / 리붓 명령으로 상태 전이 가능

#### 정지됨(Stopped)
- 중지된 상태
- EBS 볼륨을 루트로 사용하는 인스턴스만 가능, 따라서 Instance Store를 사용하는 장비는 Terminate만 가능
- 과금 안됨
- 시작 / 종료 명령으로 상태 전이 가능

#### 종료됨(Terminated)


### Amazon Machine Image(AMI)
- 인스턴스 시작에 필요한 OS 및 애플리케이션이 구성된 이미지
  - 이미지는 S3에 저장
- AWS 이외의 파트너, 커뮤니티 및 사용자도 직접 AMI 생성 가능

#### AWS 관리
- AWS가 직접 각 리전마다 관리하는 리눅스와 윈도우 이미지
  - 보안 패치 등
  - 따라서, EC2 가상머신 생성 후의 업데이트는 사용자의 책임

#### 커뮤니티 관리
- AWS를 시용하는 다른 사용자들 및 마켓플레이스 파트너에 의해 관리되고 유지되는 공개 이미지

#### 사용자 관리
- EC2 인스턴스로부터 사용자가 직접 생성한 AMI

### EC2 스토리지 구조

### Instance Store
- 임시 블록 스토어
- 호스트 서버 내장된 디스크
- 리붓을 제외한 EC2 정지나 종료 시 데이터 손실
- 스냅샷 기능 없음
- 스토리지 사용에 대한 별도의 추가비용 없음

### Amazon EBS
- 별도의 네트워크를 통한 디스크
- EC2 정지나 종료 시 데이터 손실 없음
- 스냅샷 기능 제공
- 스토리지 사용에 대한 별도의 추가비용 존재

### 키페어
- EC2 인스턴스에 접근하기 위한 인증 방식
- ID/PW보다 안전

### 부트스트래핑 (초기 기동 절차)

#### 인스턴스 사용자 데이터
- 인스턴스 생성 시, 사용자가 입력한 스크립트를 실행하는 기능
- 최대 16KB 텍스트까지 인스턴스에 전달
- 사용자 데이터로 사용할 수 있는 2가지 형식
  - 스크립트 (리눅스: `#!`로 시작)
  - cloud-init 지시문(리눅스 인스턴스)

#### 인스턴스 메타 데이터
- 실행 중인 인스턴스의 운영체제와 애플리케이션 환경을 동적으로 구성하기 위해 활용되는 EC2 인스턴스의 환경 데이터
- 인스턴스 메타데이터로 참조할 수 있는 유용한 정보
  - 호스트명, AMI ID, 인스턴스 ID, 공인 및 사설 IP 및 DNS, 인스턴스 서브넷 ID, 가용 영역
- 인스턴스 내에서 HTTP를 통하여 접근 가능
  - $ curl http://169.254.169.254/latest/meta-data/
- 호스트명을 조회하기 위한 메타데이터 사용 예
  - $ curl http://169.254.169.254/latest/meta-data/hostname

## ~~유지 관리~~
- 이번 세미나에서는 SKIP...발표자료 공유시 참고..

## 자동 확장

### 확장의 종류
- 수직적 확장 (Scale Up/Down)
  - 인스턴스 종류 변경

- 수평적 확장 (Scale Out/In)
  - 인스턴스 갯수 증가

### 확장 계획

#### 자동 확장
- 수요 기반 스케일링
- 일정 기반 스케일링
- 항상 현재 인스턴스 수준을 유지 (자가-치유)

#### 수동 확장

## 비용 모델
- 온디맨드(From 2006)
- 예약(From 2009)
- 스팟(From 2009)

### 온디맨드
- 일반적으로 사용한 만큼 금액을 지불하는 방식

### 예약
- 일정 기간 이상 특정 인스턴스들을 지속적으로 사용할 것 같을 경우, 미리 선지급 후 할인 받아 사용하는 방식

### 스팟
- 저렴하게 사용하는 대신, 인스턴스를 오랫동안 유지할 수 없는 방식, 이는 짧은 기간만 잠시 사용할 필요가 있을 떄 사용하는 방식
- 수요와 공급에 따라 컴퓨팅 가격이 변화하는 시장

